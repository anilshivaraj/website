<%- include('partials/header') %>

    <div class="dashboard-container">
        <h1 class="dashboard-title">Salesforce Performance Dashboard</h1>

        <!-- System Overview Section -->
        <div class="section-title" style="margin-top: 30px;">
            <h2
                style="font-size: 1.8rem; color: #2c3e50; margin-bottom: 20px; border-bottom: 3px solid #3498db; padding-bottom: 10px;">
                System Overview</h2>
        </div>

        <div class="metrics-grid">
            <!-- Org Information Card (Full Width) -->
            <div class="metric-card org-info-card" style="grid-column: span 2;">
                <h2>Organization Information</h2>
                <div class="org-details"
                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px;">
                    <div class="org-detail-row" style="display: flex; flex-direction: column; gap: 5px;">
                        <span class="org-label" style="font-size: 0.85rem; color: #7f8c8d;">Organization Name:</span>
                        <span class="org-value" style="font-size: 1.1rem; font-weight: 600;">
                            <%= data.orgInfo.name %>
                        </span>
                    </div>
                    <div class="org-detail-row" style="display: flex; flex-direction: column; gap: 5px;">
                        <span class="org-label" style="font-size: 0.85rem; color: #7f8c8d;">Org ID:</span>
                        <span class="org-value" style="font-size: 1.1rem; font-weight: 600; font-family: monospace;">
                            <%= data.orgInfo.orgId %>
                        </span>
                    </div>
                    <div class="org-detail-row" style="display: flex; flex-direction: column; gap: 5px;">
                        <span class="org-label" style="font-size: 0.85rem; color: #7f8c8d;">Edition:</span>
                        <span class="org-value" style="font-size: 1.1rem; font-weight: 600; color: #e67e22;">
                            <%= data.orgInfo.edition %>
                        </span>
                    </div>
                    <div class="org-detail-row" style="display: flex; flex-direction: column; gap: 5px;">
                        <span class="org-label" style="font-size: 0.85rem; color: #7f8c8d;">Instance:</span>
                        <span class="org-value" style="font-size: 1.1rem; font-weight: 600;">
                            <%= data.orgInfo.instance %>
                        </span>
                    </div>
                    <div class="org-detail-row" style="display: flex; flex-direction: column; gap: 5px;">
                        <span class="org-label" style="font-size: 0.85rem; color: #7f8c8d;">Environment:</span>
                        <span class="org-value" style="font-size: 1.1rem; font-weight: 600; color: #27ae60;">
                            <%= data.orgInfo.environmentType %>
                        </span>
                    </div>
                    <div class="org-detail-row" style="display: flex; flex-direction: column; gap: 5px;">
                        <span class="org-label" style="font-size: 0.85rem; color: #7f8c8d;">Created Date:</span>
                        <span class="org-value" style="font-size: 1.1rem; font-weight: 600;">
                            <%= data.orgInfo.createdDate %>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics Section -->
        <div class="section-title" style="margin-top: 40px;">
            <h2
                style="font-size: 1.8rem; color: #2c3e50; margin-bottom: 20px; border-bottom: 3px solid #9b59b6; padding-bottom: 10px;">
                Performance Metrics</h2>
        </div>

        <div class="metrics-grid">
            <!-- Flows Card -->
            <div class="metric-card">
                <h2>Flows Overview</h2>
                <div class="metric-summary">
                    <span class="total-count">
                        <%= data.flows.total %>
                    </span>
                    <span class="label">Total Flows</span>
                </div>
                <div class="chart-container">
                    <canvas id="flowsChart"></canvas>
                </div>
            </div>

            <!-- Apex Card -->
            <div class="metric-card">
                <h2>Apex Classes</h2>
                <div class="metric-summary">
                    <span class="total-count">
                        <%= data.apex.total %>
                    </span>
                    <span class="label">Total Classes</span>
                </div>
                <div class="chart-container">
                    <canvas id="apexChart"></canvas>
                </div>
            </div>

            <!-- Org Health Card -->
            <div class="metric-card health-card">
                <h2>Org Health</h2>
                <div class="health-metrics">
                    <div class="health-item">
                        <span class="health-label">Code Coverage</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: <%= data.health.codeCoverage %>%"></div>
                        </div>
                        <span class="health-value">
                            <%= data.health.codeCoverage %>%
                        </span>
                    </div>
                    <div class="health-item">
                        <span class="health-label">Storage Usage</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: <%= data.health.storage %>%"></div>
                        </div>
                        <span class="health-value">
                            <%= data.health.storage %>%
                        </span>
                    </div>
                    <div class="health-item">
                        <span class="health-label">SOQL Usage</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: <%= data.health.governorLimits.soql %>%"></div>
                        </div>
                        <span class="health-value">
                            <%= data.health.governorLimits.soql %>%
                        </span>
                    </div>
                    <div class="health-item">
                        <span class="health-label">DML Usage</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: <%= data.health.governorLimits.dml %>%"></div>
                        </div>
                        <span class="health-value">
                            <%= data.health.governorLimits.dml %>%
                        </span>
                    </div>
                </div>
            </div>

            <!-- License Usage Card -->
            <div class="metric-card">
                <h2>License Usage</h2>
                <div class="chart-container">
                    <canvas id="licenseChart"></canvas>
                </div>
            </div>

            <!-- API Usage Card -->
            <div class="metric-card">
                <h2>API Usage</h2>
                <div class="metric-summary">
                    <span class="total-count">
                        <%= Math.round((data.apiUsage.daily / data.apiUsage.limit) * 100) %>%
                    </span>
                    <span class="label">Daily Limit Used</span>
                </div>
                <div class="chart-container">
                    <canvas id="apiChart"></canvas>
                </div>
            </div>

            <!-- Security Health Score Card -->
            <div class="metric-card security-card">
                <h2>Security Health Check</h2>
                <div class="metric-summary">
                    <span class="total-count"
                        style="color: <%= data.securityScore >= 80 ? '#2ecc71' : data.securityScore >= 60 ? '#f39c12' : '#e74c3c' %>">
                        <%= data.securityScore %>
                    </span>
                    <span class="label">Score (out of 100)</span>
                </div>
                <div class="security-status">
                    <% if (data.securityScore>= 80) { %>
                        <span class="status-badge good">Excellent</span>
                        <% } else if (data.securityScore>= 60) { %>
                            <span class="status-badge warning">Needs Attention</span>
                            <% } else { %>
                                <span class="status-badge critical">Critical</span>
                                <% } %>
                </div>
            </div>

            <!-- Data Storage Card -->
            <div class="metric-card">
                <h2>Data Storage</h2>
                <div class="chart-container">
                    <canvas id="storageChart"></canvas>
                </div>
            </div>

            <!-- Automation Health Card -->
            <div class="metric-card" style="grid-column: span 2;">
                <h2>Automation Components</h2>
                <div class="chart-container">
                    <canvas id="automationChart"></canvas>
                </div>
            </div>

            <!-- Custom Metadata Card -->
            <div class="metric-card custom-meta-card">
                <h2>Custom Metadata</h2>
                <div class="custom-meta-grid">
                    <div class="meta-item">
                        <div class="meta-count">
                            <%= data.customMetadata.customObjects %>
                        </div>
                        <div class="meta-label">Custom Objects</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-count">
                            <%= data.customMetadata.customFields %>
                        </div>
                        <div class="meta-label">Custom Fields</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-count">
                            <%= data.customMetadata.validationRules %>
                        </div>
                        <div class="meta-label">Validation Rules</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-count">
                            <%= data.customMetadata.customSettings %>
                        </div>
                        <div class="meta-label">Custom Settings</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Overview Continued -->
        <div class="section-title" style="margin-top: 40px;">
            <h2
                style="font-size: 1.8rem; color: #2c3e50; margin-bottom: 20px; border-bottom: 3px solid #3498db; padding-bottom: 10px;">
                Additional System Information</h2>
        </div>

        <div class="metrics-grid">
            <!-- User Summary Card -->
            <div class="metric-card user-card">
                <h2>User Summary</h2>
                <div class="metric-summary">
                    <span class="total-count">
                        <%= data.users.total %>
                    </span>
                    <span class="label">Total Users</span>
                </div>
                <div class="user-stats"
                    style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0;">
                    <div class="user-stat"
                        style="text-align: center; padding: 10px; background: #d5f4e6; border-radius: 8px;">
                        <span style="display: block; font-size: 1.8rem; font-weight: 700; color: #27ae60;">
                            <%= data.users.active %>
                        </span>
                        <span style="display: block; font-size: 0.85rem; color: #16a085;">Active</span>
                    </div>
                    <div class="user-stat"
                        style="text-align: center; padding: 10px; background: #fff3cd; border-radius: 8px;">
                        <span style="display: block; font-size: 1.8rem; font-weight: 700; color: #f39c12;">
                            <%= data.users.inactive %>
                        </span>
                        <span style="display: block; font-size: 0.85rem; color: #d68910;">Inactive</span>
                    </div>
                    <div class="user-stat"
                        style="text-align: center; padding: 10px; background: #f8d7da; border-radius: 8px;">
                        <span style="display: block; font-size: 1.8rem; font-weight: 700; color: #e74c3c;">
                            <%= data.users.frozen %>
                        </span>
                        <span style="display: block; font-size: 0.85rem; color: #c0392b;">Frozen</span>
                    </div>
                </div>
                <div class="license-bar">
                    <div class="progress-bar">
                        <div class="progress"
                            style="width: <%= (data.users.total / data.users.availableLicenses * 100) %>%; background: linear-gradient(90deg, #3498db, #2980b9);">
                        </div>
                    </div>
                    <span style="font-size: 0.9rem; color: #555; margin-top: 5px; display: block;">
                        <%= data.users.total %> / <%= data.users.availableLicenses %> Licenses Used
                    </span>
                </div>
            </div>

            <!-- Sandboxes Card -->
            <div class="metric-card sandbox-card">
                <h2>Sandbox Availability</h2>
                <div class="sandbox-list" style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                    <div class="sandbox-item">
                        <span
                            style="font-size: 0.9rem; font-weight: 600; color: #2c3e50; margin-bottom: 5px; display: block;">Developer</span>
                        <div class="progress-bar" style="margin-bottom: 5px;">
                            <div class="progress"
                                style="width: <%= (data.sandboxes.developer.available / data.sandboxes.developer.total * 100) %>%; background: #3498db;">
                            </div>
                        </div>
                        <span style="font-size: 0.85rem; color: #7f8c8d;">
                            <%= data.sandboxes.developer.available %> / <%= data.sandboxes.developer.total %> Available
                        </span>
                    </div>
                    <div class="sandbox-item">
                        <span
                            style="font-size: 0.9rem; font-weight: 600; color: #2c3e50; margin-bottom: 5px; display: block;">Developer
                            Pro</span>
                        <div class="progress-bar" style="margin-bottom: 5px;">
                            <div class="progress"
                                style="width: <%= (data.sandboxes.developerPro.available / data.sandboxes.developerPro.total * 100) %>%; background: #9b59b6;">
                            </div>
                        </div>
                        <span style="font-size: 0.85rem; color: #7f8c8d;">
                            <%= data.sandboxes.developerPro.available %> / <%= data.sandboxes.developerPro.total %>
                                    Available
                        </span>
                    </div>
                    <div class="sandbox-item">
                        <span
                            style="font-size: 0.9rem; font-weight: 600; color: #2c3e50; margin-bottom: 5px; display: block;">Partial
                            Copy</span>
                        <div class="progress-bar" style="margin-bottom: 5px;">
                            <div class="progress"
                                style="width: <%= (data.sandboxes.partial.available / data.sandboxes.partial.total * 100) %>%; background: <%= data.sandboxes.partial.available === 0 ? '#e74c3c' : '#e67e22' %>;">
                            </div>
                        </div>
                        <span style="font-size: 0.85rem; color: #7f8c8d;">
                            <%= data.sandboxes.partial.available %> / <%= data.sandboxes.partial.total %> Available
                        </span>
                    </div>
                    <div class="sandbox-item">
                        <span
                            style="font-size: 0.9rem; font-weight: 600; color: #2c3e50; margin-bottom: 5px; display: block;">Full
                            Copy</span>
                        <div class="progress-bar" style="margin-bottom: 5px;">
                            <div class="progress"
                                style="width: <%= (data.sandboxes.full.available / data.sandboxes.full.total * 100) %>%; background: <%= data.sandboxes.full.available === 0 ? '#e74c3c' : '#27ae60' %>;">
                            </div>
                        </div>
                        <span style="font-size: 0.85rem; color: #7f8c8d;">
                            <%= data.sandboxes.full.available %> / <%= data.sandboxes.full.total %> Available
                        </span>
                    </div>
                </div>
            </div>

            <!-- Permission Sets & Profiles Card -->
            <div class="metric-card permission-card">
                <h2>Permission Sets & Profiles</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div class="permission-section" style="border-right: 1px solid #ecf0f1; padding-right: 15px;">
                        <h3 style="font-size: 1.1rem; color: #34495e; margin-bottom: 15px;">Permission Sets</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="text-align: center; padding: 10px; background: #ebf5fb; border-radius: 6px;">
                                <span style="display: block; font-size: 1.8rem; font-weight: 700; color: #3498db;">
                                    <%= data.permissionSets.total %>
                                </span>
                                <span style="display: block; font-size: 0.85rem; color: #2980b9;">Total Sets</span>
                            </div>
                            <div style="text-align: center; padding: 10px; background: #fef5e7; border-radius: 6px;">
                                <span style="display: block; font-size: 1.8rem; font-weight: 700; color: #f39c12;">
                                    <%= data.permissionSets.assigned %>
                                </span>
                                <span style="display: block; font-size: 0.85rem; color: #d68910;">Assignments</span>
                            </div>
                            <div style="font-size: 0.85rem; color: #7f8c8d; margin-top: 5px;">
                                <div>Custom: <%= data.permissionSets.customSets %>
                                </div>
                                <div>Standard: <%= data.permissionSets.standardSets %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="permission-section" style="padding-left: 15px;">
                        <h3 style="font-size: 1.1rem; color: #34495e; margin-bottom: 15px;">Profiles</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="text-align: center; padding: 10px; background: #ebf5fb; border-radius: 6px;">
                                <span style="display: block; font-size: 1.8rem; font-weight: 700; color: #3498db;">
                                    <%= data.profiles.total %>
                                </span>
                                <span style="display: block; font-size: 0.85rem; color: #2980b9;">Total Profiles</span>
                            </div>
                            <div style="font-size: 0.85rem; color: #7f8c8d;">
                                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                    <span>System Admin:</span>
                                    <span style="font-weight: 600;">
                                        <%= data.profiles.systemAdmin %>
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                    <span>Standard User:</span>
                                    <span style="font-weight: 600;">
                                        <%= data.profiles.standardUser %>
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                    <span>Read Only:</span>
                                    <span style="font-weight: 600;">
                                        <%= data.profiles.readOnly %>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deployment Information Card -->
            <div class="metric-card deployment-card">
                <h2>Deployment Status</h2>
                <div style="margin-top: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <span
                            style="padding: 8px 16px; background: #d5f4e6; color: #27ae60; border-radius: 20px; font-weight: 600; font-size: 0.9rem;">
                            <%= data.deployment.status %>
                        </span>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div
                            style="display: flex; justify-content: space-between; padding-bottom: 8px; border-bottom: 1px solid #ecf0f1;">
                            <span style="color: #7f8c8d; font-size: 0.9rem;">Last Deployment:</span>
                            <span style="font-weight: 600; font-size: 0.9rem;">
                                <%= new Date(data.deployment.lastDeployment).toLocaleString() %>
                            </span>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; padding-bottom: 8px; border-bottom: 1px solid #ecf0f1;">
                            <span style="color: #7f8c8d; font-size: 0.9rem;">Deployed By:</span>
                            <span style="font-weight: 600; font-size: 0.9rem;">
                                <%= data.deployment.deployedBy %>
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #7f8c8d; font-size: 0.9rem;">Pending Changes:</span>
                            <span style="font-weight: 700; font-size: 1.2rem; color: #e67e22;">
                                <%= data.deployment.pendingChanges %>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feature Licenses Card -->
            <div class="metric-card feature-license-card" style="grid-column: span 2;">
                <h2>Feature Licenses</h2>
                <div class="chart-container">
                    <canvas id="featureLicenseChart"></canvas>
                </div>
            </div>

            <!-- Connected Apps Card -->
            <div class="metric-card connected-apps-card">
                <h2>Connected Apps</h2>
                <div style="margin-top: 20px;">
                    <div class="metric-summary" style="margin-bottom: 20px;">
                        <span class="total-count">
                            <%= data.connectedApps.total %>
                        </span>
                        <span class="label">Total Apps</span>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; padding: 10px; background: #ebf5fb; border-radius: 6px;">
                            <span style="font-size: 0.9rem; color: #34495e;">OAuth Apps</span>
                            <span style="font-weight: 700; font-size: 1.1rem; color: #3498db;">
                                <%= data.connectedApps.oauth %>
                            </span>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; padding: 10px; background: #fef5e7; border-radius: 6px;">
                            <span style="font-size: 0.9rem; color: #34495e;">SAML Apps</span>
                            <span style="font-weight: 700; font-size: 1.1rem; color: #f39c12;">
                                <%= data.connectedApps.saml %>
                            </span>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; padding: 10px; background: #e8f8f5; border-radius: 6px;">
                            <span style="font-size: 0.9rem; color: #34495e;">Named Credentials</span>
                            <span style="font-weight: 700; font-size: 1.1rem; color: #16a085;">
                                <%= data.namedCredentials.total %>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Email Deliverability Card -->
            <div class="metric-card email-card">
                <h2>Email Deliverability</h2>
                <div style="margin-top: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <span
                            style="padding: 8px 16px; background: #d5f4e6; color: #27ae60; border-radius: 20px; font-weight: 600;">
                            <%= data.emailDeliverability.accessLevel %>
                        </span>
                        </span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress"
                            style="width: <%= (data.emailDeliverability.dailySent / data.emailDeliverability.dailyLimit * 100) %>%; background: linear-gradient(90deg, #3498db, #2980b9);">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Platform Cache Card -->
        <div class="metric-card cache-card">
            <h2>Platform Cache</h2>
            <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
                <div>
                    <span
                        style="font-size: 0.9rem; font-weight: 600; color: #2c3e50; margin-bottom: 8px; display: block;">Org
                        Cache</span>
                    <div class="progress-bar" style="margin-bottom: 5px;">
                        <div class="progress"
                            style="width: <%= (data.platformCache.orgCache.used / data.platformCache.orgCache.allocated * 100) %>%; background: #3498db;">
                        </div>
                    </div>
                    <span style="font-size: 0.85rem; color: #7f8c8d;">
                        <%= data.platformCache.orgCache.used %> / <%= data.platformCache.orgCache.allocated %> MB
                    </span>
                </div>
                <div>
                    <span
                        style="font-size: 0.9rem; font-weight: 600; color: #2c3e50; margin-bottom: 8px; display: block;">Session
                        Cache</span>
                    <div class="progress-bar" style="margin-bottom: 5px;">
                        <div class="progress"
                            style="width: <%= (data.platformCache.sessionCache.used / data.platformCache.sessionCache.allocated * 100) %>%; background: #9b59b6;">
                        </div>
                    </div>
                    <span style="font-size: 0.85rem; color: #7f8c8d;">
                        <%= data.platformCache.sessionCache.used %> / <%= data.platformCache.sessionCache.allocated %>
                                MB
                    </span>
                </div>
            </div>
        </div>

        <!-- Sharing Settings Card -->
        <div class="metric-card sharing-card" style="grid-column: span 2;">
            <h2>Sharing Settings</h2>
            <div style="margin-top: 20px; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #ecf0f1;">
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #2c3e50;">Object
                            </th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #2c3e50;">Internal
                                Access</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #2c3e50;">External
                                Access</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 12px; font-weight: 500;">Account</td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.account.internal %>
                                </span></td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.account.external %>
                                </span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 12px; font-weight: 500;">Contact</td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #d1ecf1; color: #0c5460; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.contact.internal %>
                                </span></td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.contact.external %>
                                </span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 12px; font-weight: 500;">Opportunity</td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.opportunity.internal %>
                                </span></td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.opportunity.external %>
                                </span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 12px; font-weight: 500;">Lead</td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.lead.internal %>
                                </span></td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.lead.external %>
                                </span></td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; font-weight: 500;">Case</td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.case.internal %>
                                </span></td>
                            <td style="padding: 12px;"><span
                                    style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 0.85rem;">
                                    <%= data.sharingSettings.case.external %>
                                </span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Data from server
        const flowData = {
            labels: ['Screen', 'Auto-Launched', 'Triggered'],
            datasets: [{
                data: [<%= data.flows.screen %>, <%= data.flows.autoLaunched %>, <%= data.flows.triggered %>],
                backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'],
                borderWidth: 0
            }]
        };

        const apexData = {
            labels: ['Invocable', 'Controller', 'Test', 'Batch/Queueable'],
            datasets: [{
                data: [<%= data.apex.invocable %>, <%= data.apex.controller %>, <%= data.apex.test %>, <%= data.apex.batch %>],
                backgroundColor: ['#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF'],
                borderWidth: 0
            }]
        };

        // Charts Configuration
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        usePointStyle: true,
                        padding: 20
                    }
                }
            },
            cutout: '70%'
        };

        // Render Charts
        new Chart(document.getElementById('flowsChart'), {
            type: 'doughnut',
            data: flowData,
            options: commonOptions
        });

        new Chart(document.getElementById('apexChart'), {
            type: 'doughnut',
            data: apexData,
            options: commonOptions
        });

        // Feature License Chart
        new Chart(document.getElementById('featureLicenseChart'), {
            type: 'bar',
            data: {
                labels: ['Marketing Cloud', 'Sales Cloud', 'Service Cloud', 'CPQ', 'Chatter', 'Knowledge', 'Communities'],
                datasets: [{
                    label: 'Assigned',
                    data: [
                        <%= data.featureLicenses.marketingCloud.assigned %>,
                        <%= data.featureLicenses.salesCloud.assigned %>,
                        <%= data.featureLicenses.serviceCloud.assigned %>,
                        <%= data.featureLicenses.cpq.assigned %>,
                        <%= data.featureLicenses.chatter.assigned %>,
                        <%= data.featureLicenses.knowledge.assigned %>,
                        <%= data.featureLicenses.communities.assigned %>
                    ],
                    backgroundColor: '#3498db'
                }, {
                    label: 'Available',
                    data: [
                        <%= data.featureLicenses.marketingCloud.total - data.featureLicenses.marketingCloud.assigned %>,
                        <%= data.featureLicenses.salesCloud.total - data.featureLicenses.salesCloud.assigned %>,
                        <%= data.featureLicenses.serviceCloud.total - data.featureLicenses.serviceCloud.assigned %>,
                        <%= data.featureLicenses.cpq.total - data.featureLicenses.cpq.assigned %>,
                        <%= data.featureLicenses.chatter.total - data.featureLicenses.chatter.assigned %>,
                        <%= data.featureLicenses.knowledge.total - data.featureLicenses.knowledge.assigned %>,
                        <%= data.featureLicenses.communities.total - data.featureLicenses.communities.assigned %>
                    ],
                    backgroundColor: '#ecf0f1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                },
                scales: {
                    x: { stacked: true },
                    y: {
                        stacked: true,
                        beginAtZero: true
                    }
                }
            }
        });

        // License Chart
        new Chart(document.getElementById('licenseChart'), {
            type: 'bar',
            data: {
                labels: ['Salesforce', 'Platform', 'Integration'],
                datasets: [{
                    label: 'Used',
                    data: [<%= data.licenses.salesforce.used %>, <%= data.licenses.platform.used %>, <%= data.licenses.integration.used %>],
                    backgroundColor: '#3498db'
                }, {
                    label: 'Total',
                    data: [<%= data.licenses.salesforce.total %>, <%= data.licenses.platform.total %>, <%= data.licenses.integration.total %>],
                    backgroundColor: '#ecf0f1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                },
                scales: {
                    x: { stacked: true },
                    y: { stacked: true }
                }
            }
        });

        // API Usage Chart
        new Chart(document.getElementById('apiChart'), {
            type: 'doughnut',
            data: {
                labels: ['Used', 'Remaining'],
                datasets: [{
                    data: [<%= data.apiUsage.daily %>, <%= data.apiUsage.limit - data.apiUsage.daily %>],
                    backgroundColor: ['#e74c3c', '#ecf0f1'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                },
                circumference: 180,
                rotation: -90,
                cutout: '80%'
            }
        });

        // Data Storage Chart
        new Chart(document.getElementById('storageChart'), {
            type: 'bar',
            data: {
                labels: ['Data Storage', 'File Storage'],
                datasets: [{
                    label: 'Used (GB)',
                    data: [<%= data.dataStorage.dataUsed %>, <%= data.dataStorage.fileUsed %>],
                    backgroundColor: '#3498db'
                }, {
                    label: 'Available (GB)',
                    data: [<%= data.dataStorage.dataTotal - data.dataStorage.dataUsed %>, <%= data.dataStorage.fileTotal - data.dataStorage.fileUsed %>],
                    backgroundColor: '#ecf0f1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                },
                scales: {
                    x: { stacked: true },
                    y: {
                        stacked: true,
                        beginAtZero: true
                    }
                }
            }
        });

        // Automation Chart
        new Chart(document.getElementById('automationChart'), {
            type: 'bar',
            data: {
                labels: ['Workflows', 'Process Builders', 'Flows', 'Triggers'],
                datasets: [{
                    label: 'Count',
                    data: [<%= data.automation.workflows %>, <%= data.automation.processBuilders %>, <%= data.automation.flows %>, <%= data.automation.triggers %>],
                    backgroundColor: ['#9b59b6', '#e67e22', '#1abc9c', '#34495e']
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>

    <%- include('partials/footer') %>